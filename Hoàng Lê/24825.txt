24825
1. Cài đặt ksqlDB cluster
confluent.controlcenter.connect.Cluster-Test1.cluster=http://localhost:8083

2. Lỗi không nhận dữ liệu từ mysql connect 
ksql> create TABLE  testsqlmoviedbscore
>(
> ScoreID STRING PRIMARY KEY,
>  ActorID STRING,
>  popularity double,
>  vote_avarage double,
>  vote_count double
>)
>WITH (
>  KAFKA_TOPIC = 'TestSQL.MovieDB.Score',
>  VALUE_FORMAT = 'JSON',
>  PARTITIONS = 1
>);
dữ liệu từ scoreID vẫn nhận nhưng ở định dạng JSON:
SELECT * FORM testsqlmoviedbscore EMIT CHANGES;

SCOREID                                |ACTORID                                |POPULARITY                             |VOTE_AVARAGE                           |VOTE_COUNT                             |
+---------------------------------------+---------------------------------------+---------------------------------------+---------------------------------------+---------------------------------------+
|{"schema":{"type":"struct","fields":[{"|null                                   |null                                   |null                                   |null                                   |
|type":"int32","optional":false,"field":|                                       |                                       |                                       |                                       |
|"ScoreID"}],"optional":false,"name":"Te|                                       |                                       |                                       |                                       |
|stSQL.MovieDB.Score.Key"},"payload":{"S|                                       |                                       |                                       |                                       |
|coreID":1}}      

3. Tạo Stream cho database và bảng mới 
ksql> CREATE STREAM Diem_full (
>  BEFORE STRUCT<
>    ID_Diem STRING,
>    Diem_Toan INT,
>    Diem_Van INT,
>    Diem_Anh INT
>  >,
>  AFTER STRUCT<
>    ID_Diem STRING,
>    Diem_Toan INT,
>    Diem_Van INT,
>    Diem_Anh INT
>  >,
>  SOURCE STRUCT<
>    VERSION STRING,
>    `CONNECTOR` STRING,
>    NAME STRING,
>    TS_MS BIGINT,
>    SNAPSHOT STRING,
>    DB STRING,
>   `TABLE` STRING
>  >,
>  OP STRING,
>  TS_MS BIGINT
>) WITH (
>  KAFKA_TOPIC = 'T.Human1.Diem',
>  VALUE_FORMAT = 'JSON'
>);
Tạo Stream chỉ chứa dữ liệu after
CREATE STREAM Diem AS
>  SELECT
>    AFTER->ID_Diem     AS ID_Diem,
>    AFTER->Diem_Toan   AS Diem_Toan,
>    AFTER->Diem_Van    AS Diem_Van,
>    AFTER->Diem_Anh    AS Diem_Anh
>  FROM Diem_full
>  EMIT CHANGES;
Tạo table 
CREATE TABLE Diem_TB AS
>  SELECT
>    AFTER->ID_Diem     AS ID_Diem,
>    LATEST_BY_OFFSET(AFTER->Diem_Toan) AS Diem_Toan,
>    LATEST_BY_OFFSET(AFTER->Diem_Van)  AS Diem_Van,
>    LATEST_BY_OFFSET(AFTER->Diem_Anh)  AS Diem_Anh
>  FROM Diem_full
>  GROUP BY AFTER->ID_Diem
>  EMIT CHANGES;
ksql> select * from DIEM_TB emit changes;
+----------------------------------+----------------------------------+----------------------------------+----------------------------------+
|ID_DIEM                           |DIEM_TOAN                         |DIEM_VAN                          |DIEM_ANH                          |
+----------------------------------+----------------------------------+----------------------------------+----------------------------------+
Query terminated
Vẫn không nhận dữ liệu (đã đổi qua value.converter.schema.enable=false)
- Connector đã tạo topic cho bảng và nhận đủ message

!!!!!!!!!!!!!!ĐCM CUỘC ĐỜI ĐÃ SỬA ĐƯỢC!!!!!!!!!!!
CÁI NÀY QUAN TRỌNG VÃI CẢ LỒN ----------> SET 'auto.offset.reset'='earliest'; <--------------- CÁI NÀY QUAN TRỌNG VÃI CẢ LỒN
unwrap dữ liệu 
auto.offset.reset='earliest'
NHƯNG KHÔNG SINK ĐƯỢC VÌ THIẾU SCHEMA
nếu không unwrap dữ liệu sẽ là null

!!!!!!!!!!!!!!!!!!!!SỬA KIỂU KHÁC VẪN GIỮ CHEMA!!!!!!!!!!!!!!!!!!!!!!!
unwrap nhưng "schema.enable": "true"
@@@@Tạo stream chứa toàn bộ source và schema:@@@@
CREATE STREAM diem2_src (
>    schema STRUCT<
>        type STRING,
>        fields ARRAY<STRUCT<type STRING, optional BOOLEAN, field STRING>>,
>        optional BOOLEAN,
>        name STRING
>    >,
>    payload STRUCT<
>        ID INT,
>        Diem_Toan INT,
>        Diem_Van INT,
>        Diem_Anh INT,
>        __deleted STRING
>    >
>) WITH (
>    KAFKA_TOPIC='X1.Human1.Diem',
>    VALUE_FORMAT='JSON'
>);

@@@Tạo stream đọc dữ liệu payload từ source:@@@
CREATE STREAM diem2 AS
>SELECT
>    payload->ID AS ID,
>    payload->Diem_Toan AS Diem_Toan,
>    payload->Diem_Van AS Diem_Van,
>    payload->Diem_Anh AS Diem_Anh
>FROM diem2_src
>EMIT CHANGES;
