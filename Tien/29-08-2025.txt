Task 1 và 2: cài đặt confluent platform và các cụm sử dụng KRaft
--- Cài đặt curl và which
sudo yum install curl which
--- Cài Confluent Platform public key
sudo rpm --import https://packages.confluent.io/rpm/8.0/archive.key
--- Chuyển đến location và tạo confluent.repo
cd /etc/yum.repos.d/
touch confluent.repo
--- Clear the YUM caches và cài Confluent Platform.
sudo yum clean all && sudo yum install confluent-platform
--- Tạo file cấu hình 
cat <<EOF > /etc/kafka/server.properties
process.roles=broker,controller
node.id=1
controller.quorum.voters=1@localhost:9093
controller.listener.names=CONTROLLER
listeners=PLAINTEXT://localhost:9092,CONTROLLER://localhost:9093
advertised.listeners=PLAINTEXT://localhost:9092
listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
inter.broker.listener.name=PLAINTEXT
log.dirs=/data/apps/kafka/data
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
share.coordinator.state.topic.replication.factor=1
share.coordinator.state.topic.min.isr=1
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
num.network.threads=3
num.io.threads=8
socket.request.max.bytes=104857600
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
confluent.license.topic.replication.factor=1
confluent.metadata.topic.replication.factor=1
confluent.balancer.topic.replication.factor=1
confluent.security.event.logger.exporter.kafka.topic.replicas=1
EOF
--- Tạo cluster ID
kafka-storage random-uuid
k7yiu6h5RXisnbOjhF09fg
kafka-storage format -t kyLmB5WbSh6mcGcHyngt2A -c /etc/kafka/server.properties

mkdir -p /etc/systemd/system/confluent-server.service.d 
cat <<EOF >  /etc/systemd/system/confluent-server.service.d/override.conf
[Service]
Environment="LOG_DIR=/data/apps/logs"
Environment="KAFKA_HEAP_OPTS=-Xms2G -Xmx2G"
EOF
--- Chạy Confluent Platform
systemctl daemon-reexec
systemctl daemon-reload
systemctl start confluent-server
--- Kiểm tra user và group  và cấp quyền 
cat /usr/lib/systemd/system/confluent-server.service
ls -ld /data/apps/logs
chown -R cp-kafka:confluent /data/apps/logs
ls -ld /data/apps/kafka/data/
chown -R cp-kafka:confluent /data/apps/kafka/data
--- Chạy lại confluent
systemctl restart confluent-server
systemctl status confluent-server